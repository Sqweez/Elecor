(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"+F2W":function(t,e,n){"use strict";var a={props:{state:{type:Boolean,default:!1},title:{type:String,default:"Подтвердите действие"},message:{type:String,required:!0},okMessage:{type:String,default:"ОК"},cancelMessage:{type:String,default:"Отмена"}},methods:{onConfirm:function(){this.$emit("confirm")},onCancel:function(){this.$emit("cancel")}}},s=(n("dXLZ"),n("KHd+")),i=Object(s.a)(a,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-dialog",{attrs:{persistent:"",width:"500"},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[t._v(t._s(t.title))]),t._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:t.onCancel}},[t._v("\n                        mdi-close\n                    ")])],1)],1),t._v(" "),n("v-card-text",{staticClass:"modal-text"},[t._v("\n                "+t._s(t.message)+"\n            ")]),t._v(" "),n("v-divider"),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{text:""},on:{click:t.onCancel}},[t._v("\n                    "+t._s(t.cancelMessage)+"\n                ")]),t._v(" "),n("v-btn",{attrs:{color:"success",text:""},on:{click:t.onConfirm}},[t._v("\n                    "+t._s(t.okMessage)+"\n                    "),n("v-icon",[t._v("mdi-check")])],1)],1)],1)],1)],1)}),[],!1,null,"2adaa561",null);e.a=i.exports},F3ox:function(t,e,n){var a=n("toHN");"string"==typeof a&&(a=[[t.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(a,s);a.locals&&(t.exports=a.locals)},dXLZ:function(t,e,n){"use strict";var a=n("F3ox");n.n(a).a},toHN:function(t,e,n){(t.exports=n("I1BE")(!1)).push([t.i,"\n.modal-text[data-v-2adaa561] {\n    margin-top: 15px!important;;\n    font-size: 16px;\n}\n",""])},"ztL/":function(t,e,n){"use strict";n.r(e);var a=n("o0o1"),s=n.n(a),i=n("BWV3");String.prototype.replaceAll=function(t,e){return this.split(t).join(e)};var r={props:{state:{type:Boolean,default:!1},id:{type:Number,default:null}},computed:{message:function(){var t=this.body;return this.variables.forEach((function(e){t=t.replaceAll(e.key,e.example)})),t}},watch:{state:function(){if(this.name="",this.title="",this.body="",null!==this.id){var t=this.$store.getters.mailing_template(this.id);this.name=t.name,this.title=t.title,this.body=t.body}}},data:function(){return{loading:!1,name:"",title:"",body:"",variables:[{key:"%ИМЯ%",name:"Имя клиента",example:"Александр Андреевич"}]}},methods:{onSubmit:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.loading=!0,null!==this.id){t.next=6;break}return t.next=4,s.a.awrap(this.createTemplate());case 4:t.next=8;break;case 6:return t.next=8,s.a.awrap(this.editTemplate());case 8:this.$emit("onClose"),this.loading=!1;case 11:case"end":return t.stop()}}),null,this)},createTemplate:function(){var t;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:this.title,body:this.body,name:this.name},e.next=3,s.a.awrap(this.$store.dispatch("createMailingTemplates",t));case 3:Object(i.a)("Шаблон успешно создан!");case 4:case"end":return e.stop()}}),null,this)},editTemplate:function(){var t;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:this.id,title:this.title,body:this.body,name:this.name},e.next=3,s.a.awrap(this.$store.dispatch("editMailingTemplates",t));case 3:Object(i.a)("Шаблон успешно отредактирован!");case 4:case"end":return e.stop()}}),null,this)},addVariableToTemplate:function(t){this.body+=t.key}}},l=n("KHd+"),o=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"blue darken-1 d-flex justify-content-between"},[n("span",{staticClass:"white--text"},[t._v(t._s(null===t.id?"Добавление":"Редактирование")+" шаблона")]),t._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(e){return t.$emit("onClose")}}},[n("v-icon",{attrs:{color:"white"}},[t._v("mdi-close")])],1)],1),t._v(" "),n("v-card-text",[t.loading?t._e():n("v-form",{staticClass:"p-3"},[n("v-text-field",{attrs:{label:"Наименование шаблона"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),n("v-text-field",{attrs:{label:"Заголовок"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),n("v-textarea",{attrs:{"auto-grow":"",rows:"5",counter:"",label:"Текст"},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}}),t._v(" "),n("v-flex",{staticClass:"mb-2"},[n("h4",{staticClass:"ml-1"},[t._v("Переменные:")]),t._v(" "),t._l(t.variables,(function(e,a){return n("v-btn",{key:a,staticClass:"m-1",attrs:{small:"",color:"primary"},on:{click:function(n){return t.addVariableToTemplate(e)}}},[t._v("\n                        "+t._s(e.name)+"\n                    ")])}))],2),t._v(" "),n("v-divider"),t._v(" "),n("v-flex",{staticClass:"mt-2"},[n("h3",[t._v("Предпросмотр шаблона:")]),t._v(" "),n("h4",[t._v(t._s(this.title))]),t._v(" "),n("p",[t._v(t._s(this.message))])])],1)],1),t._v(" "),n("v-divider"),t._v(" "),t.loading?t._e():n("v-card-actions",[n("v-btn",{attrs:{text:""},on:{click:function(e){return t.$emit("onClose")}}},[t._v("Отмена")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-btn",{attrs:{text:"",color:"success"},on:{click:t.onSubmit}},[t._v("\n                Сохранить\n                "),n("v-icon",[t._v("mdi-check")])],1)],1),t._v(" "),n("v-progress-linear",{attrs:{indeterminate:"",active:t.loading,color:"green",absolute:"",bottom:""}})],1)],1)}),[],!1,null,"7d46370f",null).exports,c=n("+F2W"),u={components:{ConfirmationModal:c.a,AddMailingTemplateModal:o},methods:{onEdit:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:this.showEditModal=!1,Object(i.a)("","Шаблон успешно изменен!");case 2:case"end":return t.stop()}}),null,this)},onSave:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:this.showAddModal=!1,Object(i.a)("","Шаблон успешно добавлен!");case 2:case"end":return t.stop()}}),null,this)}},computed:{templates:function(){return this.$store.getters.mailing_templates}},data:function(){return{id:null,showEditModal:!1,showAddModal:!1,showDeleteModal:!1,headers:[{text:"Наименование шаблона",value:"title",sortable:!1},{text:"Текст шаблона",value:"body",sortable:!1},{text:"Действие",value:"action",sortable:!1}],search:""}}},d=Object(l.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mt-3"},[n("div",{staticClass:"d-flex justify-content-end"},[n("v-btn",{staticClass:"mb-2",attrs:{color:"primary"},on:{click:function(e){t.showAddModal=!0}}},[t._v("Добавить шаблон")])],1),t._v(" "),n("v-data-table",{attrs:{"no-results-text":"Нет результатов","no-data-text":"Нет данных","footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:t.headers,items:t.templates,search:t.search},scopedSlots:t._u([{key:"item.action",fn:function(e){var a=e.item;return[n("v-btn",{attrs:{icon:""},on:{click:function(e){t.id=a.id,t.showAddModal=!0}}},[n("v-icon",[t._v("mdi-pencil")])],1),t._v(" "),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-delete")])],1)]}},{key:"footer.page-text",fn:function(e){var n=e.pageStart,a=e.pageStop,s=e.itemsLength;return[t._v("\n            "+t._s(n)+"-"+t._s(a)+" из "+t._s(s)+"\n        ")]}}])}),t._v(" "),n("AddMailingTemplateModal",{attrs:{state:t.showAddModal,id:t.id},on:{onClose:function(e){t.id=null,t.showAddModal=!1}}}),t._v(" "),n("ConfirmationModal",{attrs:{state:t.showDeleteModal,message:"Вы действительно хотите удалить выбранный шаблон?"},on:{confirm:function(e){t.showDeleteModal=!1},cancel:function(e){t.showDeleteModal=!1}}})],1)}),[],!1,null,"17d90edc",null).exports,v=n("C3xL");function m(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}String.prototype.replaceAll=function(t,e){return this.split(t).join(e)};var p={components:{ConfirmationModal:c.a},methods:{addVariableToTemplate:function(t){this.body+=t.key},sendMailing:function(){var t;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:this.title,body:this.body,clients:this.selected.map((function(t){return t.id})),sendType:this.sendType},this.showModal=!1,e.next=4,s.a.awrap(Object(v.g)(t));case 4:Object(i.a)("Рассылка была отправлена");case 5:case"end":return e.stop()}}),null,this)}},data:function(){return{showModal:!1,sendingTypes:[{id:0,name:"Все"},{id:1,name:"SMS"},{id:"2",name:"Пуш-уведомления"}],sendType:2,variables:[{key:"%ИМЯ%",name:"Имя клиента",example:"Александр Андреевич"}],methods:{addVariableToTemplate:function(t){this.body+=t.key}},search:"",selected:[],currentTemplate:null,headers:[{text:"Контрагент",align:"left",sortable:!1,value:"name"},{text:"Лицевой счет",value:"personal_accounts",sortable:!1},{text:"Адрес",value:"addresses",sortable:!1},{text:"Торговое наименование",value:"trademarks",sortable:!1}],isFreeTemplate:!1,clientGroup:null,clientGroups:["Все","Должники"],title:"",body:""}},watch:{currentTemplate:function(){var t=this.$store.getters.mailing_template(this.currentTemplate);return this.body=t.body,this.title=t.title,t}},computed:{clients:function(){var t=[];return t="Все"===this.clientGroup?this.$store.getters.allClients:this.$store.getters.debts,this.selected=m(t),t},message:function(){var t=this.body;return this.variables.forEach((function(e){t=t.replaceAll(e.key,e.example)})),t},templates:function(){return this.$store.getters.mailing_templates}}},f=Object(l.a)(p,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[0===t.$store.getters.debts.length?n("div",{staticClass:"text-center d-flex align-items-center justify-content-center",staticStyle:{"min-height":"651px"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"65",color:"primary"}})],1):n("v-form",{staticClass:"p-3"},[n("v-select",{attrs:{"item-value":"id","item-text":"name",label:"Тип отправки",items:t.sendingTypes},model:{value:t.sendType,callback:function(e){t.sendType=e},expression:"sendType"}}),t._v(" "),n("v-flex",[t.isFreeTemplate?t._e():n("v-select",{attrs:{label:"Шаблон",items:t.templates,"item-text":"name","item-value":"id"},model:{value:t.currentTemplate,callback:function(e){t.currentTemplate=e},expression:"currentTemplate"}}),t._v(" "),n("v-checkbox",{attrs:{label:"Произвольный шаблон"},model:{value:t.isFreeTemplate,callback:function(e){t.isFreeTemplate=e},expression:"isFreeTemplate"}})],1),t._v(" "),n("v-text-field",{attrs:{label:"Заголовок"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t._v(" "),n("v-textarea",{attrs:{label:"Текст","auto-grow":"",rows:"5",counter:""},model:{value:t.body,callback:function(e){t.body=e},expression:"body"}}),t._v(" "),n("v-flex",{staticClass:"mb-2"},[n("h4",{staticClass:"ml-1"},[t._v("Переменные:")]),t._v(" "),t._l(t.variables,(function(e,a){return n("v-btn",{key:a,staticClass:"m-1",attrs:{small:"",color:"primary"},on:{click:function(n){return t.addVariableToTemplate(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}))],2),t._v(" "),n("v-select",{attrs:{label:"Группа клиентов",items:t.clientGroups},model:{value:t.clientGroup,callback:function(e){t.clientGroup=e},expression:"clientGroup"}}),t._v(" "),t.clientGroup?n("v-data-table",{attrs:{"item-key":"id","show-select":"","no-results-text":"Нет результатов","no-data-text":"Нет данных","footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:t.headers,items:t.clients,search:t.search},scopedSlots:t._u([{key:"item.personal_accounts",fn:function(e){var a=e.item;return[n("ul",t._l(a.personal_accounts,(function(e,a){return n("li",{key:a},[t._v(t._s(e))])})),0)]}},{key:"item.addresses",fn:function(e){var a=e.item;return[n("ul",t._l(a.addresses,(function(e,a){return n("li",{key:a},[t._v(t._s(e))])})),0)]}},{key:"item.trademarks",fn:function(e){var a=e.item;return[n("ul",t._l(a.trademarks,(function(e,a){return n("li",{key:a},[t._v(t._s(e))])})),0)]}},{key:"footer.page-text",fn:function(e){var n=e.pageStart,a=e.pageStop,s=e.itemsLength;return[t._v("\n                "+t._s(n)+"-"+t._s(a)+" из "+t._s(s)+"\n            ")]}}],null,!1,2844864363),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}):t._e(),t._v(" "),t.clientGroup?n("div",{staticClass:"d-flex"},[n("h4",[t._v("Количество получателей: "+t._s(t.selected.length))])]):t._e(),t._v(" "),n("v-divider"),t._v(" "),n("v-flex",{staticClass:"mt-2"},[n("h3",[t._v("Предпросмотр шаблона:")]),t._v(" "),n("h4",[t._v(t._s(this.title))]),t._v(" "),n("p",[t._v(t._s(this.message))])]),t._v(" "),t.selected.length?n("v-btn",{attrs:{color:"primary"},on:{click:function(e){t.showModal=!0}}},[t._v("Отправить рассылку")]):t._e()],1),t._v(" "),n("ConfirmationModal",{attrs:{state:t.showModal,message:"Вы действительно хотите отправить эту рассылку?"},on:{cancel:function(e){t.showModal=!1},confirm:t.sendMailing}})],1)}),[],!1,null,"77854d99",null).exports;var h={components:{ConfirmationModal:c.a},mounted:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(Object(v.e)());case 2:this.items=t.sent;case 3:case"end":return t.stop()}}),null,this)},data:function(){return{showDeleteModal:!1,search:"",items:[],id:null,headers:[{text:"Заголовок",value:"title",sortable:!1},{text:"Текст",value:"body",sortable:!1},{text:"Дата рассылки",value:"date"},{text:"Количество получателей",value:"recipient_count"},{text:"Автор",value:"user",sortable:!1},{text:"Действие",value:"action",sortable:!1}]}},computed:{},methods:{deleteHistory:function(){var t=this;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(Object(v.b)(this.id));case 2:this.items=this.items.filter((function(e){return e.id!==t.id})),this.id=null,this.showDeleteModal=!1,Object(i.a)("Рассылка успешно удалена!");case 6:case"end":return e.stop()}}),null,this)}}},_={components:{MailingHistorySegment:Object(l.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mt-2"},[n("v-text-field",{attrs:{label:"Поиск",clearable:"","single-line":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t._v(" "),n("v-data-table",{attrs:{"no-data-text":"Нет данных","no-results-text":"Нет результатов",items:t.items,"footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:t.headers,search:t.search},scopedSlots:t._u([{key:"item.body",fn:function(e){var a=e.item;return[n("i",[t._v(t._s(a.body))])]}},{key:"item.action",fn:function(e){var a=e.item;return[n("v-btn",{attrs:{icon:""},on:{click:function(e){t.id=a.id,t.showDeleteModal=!0}}},[n("v-icon",[t._v("mdi-delete")])],1)]}},{key:"footer.page-text",fn:function(e){var n=e.pageStart,a=e.pageStop,s=e.itemsLength;return[t._v("\n            "+t._s(n)+"-"+t._s(a)+" из "+t._s(s)+"\n        ")]}}])}),t._v(" "),n("ConfirmationModal",{attrs:{state:t.showDeleteModal,message:"'Вы действительно хотите удалить данную рассылку из истории?"},on:{cancel:function(e){t.id=null,t.showDeleteModal=!1},confirm:t.deleteHistory}})],1)}),[],!1,null,"04279ec4",null).exports,MailingSegment:f,MailingTemplateSegment:d},data:function(){return{currentSegment:"mailing"}},mounted:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(this.$store.dispatch("getDebts"));case 2:return t.next=4,s.a.awrap(this.$store.dispatch("getMailingTemplates"));case 4:case"end":return t.stop()}}),null,this)}},b=Object(l.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-card",[n("v-card-title",[t._v("\n            Рассылка\n        ")]),t._v(" "),n("v-card-text",[n("div",{staticClass:"p-3"},[n("v-btn",{attrs:{depressed:"",color:"mailing"===t.currentSegment?"primary":""},on:{click:function(e){t.currentSegment="mailing"}}},[t._v("\n                    Рассылка\n                ")]),t._v(" "),n("v-btn",{attrs:{depressed:"",color:"mailing_history"===t.currentSegment?"primary":""},on:{click:function(e){t.currentSegment="mailing_history"}}},[t._v("\n                    История рассылок\n                ")]),t._v(" "),n("v-btn",{attrs:{depressed:"",color:"mailing_template"===t.currentSegment?"primary":""},on:{click:function(e){t.currentSegment="mailing_template"}}},[t._v("\n                    Шаблоны\n                ")]),t._v(" "),"mailing"===t.currentSegment?n("MailingSegment"):t._e(),t._v(" "),"mailing_history"===t.currentSegment?n("MailingHistorySegment"):t._e(),t._v(" "),"mailing_template"===t.currentSegment?n("MailingTemplateSegment"):t._e()],1)])],1)],1)}),[],!1,null,"dfd16ab8",null);e.default=b.exports}}]);