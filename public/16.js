(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{Nqaf:function(t,e,n){"use strict";n.r(e);var a=n("o0o1"),r=n.n(a),s=n("uzyW"),i=n("vDqi"),o=n.n(i),c=n("wd/R"),l=n.n(c),u={data:function(){return{exportVariant:null,variants:[],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]}},methods:{parseMonths:function(){for(var t=this,e=l()(),n=l()().subtract(11,"months").clone(),a=[];e>n||n.format("M")===e.format("M");)a.push(n.format("YYYY-MM")),n.add(1,"month");return a.map((function(e){var n=e.split("-"),a=n[0],r=t.monthNames[parseInt(n[1])-1];return{name:"".concat(r,", ").concat(a," г."),value:e+"-01"}})).reverse()}},computed:{},created:function(){return r.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:this.variants=this.parseMonths(),this.exportVariant=this.variants[0].value;case 2:case"end":return t.stop()}}),null,this)},props:{state:{type:Boolean,default:!1}}},v=n("KHd+"),d={components:{ExportDebtsModal:Object(v.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{"max-width":"600",persistent:""},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[t._v("Экспорт дебиторской задолженности")]),t._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:function(e){return t.$emit("cancel")}}},[t._v("\n                    mdi-close\n                ")])],1)],1),t._v(" "),n("v-card-text",[n("v-select",{attrs:{label:"Выберите вариант экспорта",items:t.variants,"item-value":"value","item-text":"name"},model:{value:t.exportVariant,callback:function(e){t.exportVariant=e},expression:"exportVariant"}})],1),t._v(" "),n("v-divider"),t._v(" "),n("v-card-actions",[n("v-btn",{attrs:{text:""},on:{click:function(e){return t.$emit("cancel")}}},[t._v("Отмена")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-btn",{attrs:{text:"",color:"success"},on:{click:function(e){return t.$emit("submit",t.exportVariant)}}},[t._v("Экспорт "),n("v-icon",[t._v("mdi-check")])],1)],1)],1)],1)}),[],!1,null,"3805d1f2",null).exports},mounted:function(){var t;return r.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a.awrap(Object(s.h)());case 2:t=e.sent,this.clients=t.debts,this.total_debt=t.total_debt;case 5:case"end":return e.stop()}}),null,this)},computed:{user:function(){return this.$store.getters.user}},data:function(){return{isMTK:!1,clients:null,overlay:!1,search:"",total_debt:0,exportModal:!1,headers:[{text:"Контрагент",align:"left",sortable:!1,value:"name"},{text:"Лицевой счет",value:"personal_account",sortable:!1},{text:"Адрес",value:"address",sortable:!1},{text:"Торговое наименование",value:"trademark",sortable:!1},{text:"Задолженность",value:"debt",sortable:!1},{text:"лиц счета",value:"_personalAccounts",visible:!1,align:" d-none"},{text:"адреса",value:"_addresses",visible:!1,align:" d-none"},{text:"торговые наименования",value:"_trademarks",visible:!1,align:" d-none"}]}},methods:{rowClick:function(t){window.open(window.origin+"/clients/"+t.id,"_blank")},openInNewTab:function(t){this.$router.push({name:"clients.show",params:{userId:t.id}})},exportData:function(t){var e,n,a,s;return r.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return this.overlay=!0,this.exportModal=!1,e=this.isMTK?"&mtk=1":"",i.next=5,r.a.awrap(o.a.get("/api/export/debts?date=".concat(t).concat(e)));case 5:n=i.sent,a=n.data,(s=document.createElement("a")).href=a,s.click(),this.overlay=!1,this.isMTK=!1;case 12:case"end":return i.stop()}}),null,this)}}},p={components:{ReceivableTable:Object(v.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-overlay",{model:{value:t.overlay,callback:function(e){t.overlay=e},expression:"overlay"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"48",color:"primary"}})],1),t._v(" "),n("v-card",[n("v-card-title",[t._v("\n            Дебиторская задолженность\n        ")]),t._v(" "),n("v-card-text",{staticClass:"p-3"},[null===t.clients?n("div",{staticClass:"text-center d-flex align-items-center justify-content-center",staticStyle:{"min-height":"651px"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"65",color:"primary"}})],1):t._e(),t._v(" "),null!==t.clients?n("div",[n("h3",[t._v("Общая задолженность: "+t._s(-1*t.total_debt)+" тенге")]),t._v(" "),n("v-divider",{staticClass:"mt-4"}),t._v(" "),2!==t.user.role_id?n("v-btn",{attrs:{color:"primary mt-4"},on:{click:function(e){t.exportModal=!0}}},[t._v("Экспорт данных\n                    "),n("v-icon",[t._v("mdi-file-excel-box")])],1):t._e(),t._v(" "),2!==t.user.role_id?n("v-btn",{attrs:{color:"primary mt-4"},on:{click:function(e){t.exportModal=!0,t.isMTK=!0}}},[t._v("\n                    Экспорт данных МТК\n                    "),n("v-icon",[t._v("mdi-file-excel-box")])],1):t._e(),t._v(" "),n("v-spacer"),t._v(" "),n("v-text-field",{staticClass:"p-3",attrs:{clearable:"","append-icon":"mdi-account-search",label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t._v(" "),n("v-data-table",{attrs:{"no-results-text":"Нет результатов","no-data-text":"Нет данных","footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:t.headers,items:t.clients,search:t.search},on:{"click:row":t.rowClick},scopedSlots:t._u([{key:"item.personal_account",fn:function(e){var a=e.item;return[n("ul",t._l(a.connections,(function(e,a){return n("li",{key:a},[t._v(t._s(e.personal_account))])})),0)]}},{key:"item.address",fn:function(e){var a=e.item;return[n("ul",t._l(a.connections,(function(e,a){return n("li",{key:a},[t._v(t._s(e.address))])})),0)]}},{key:"item.trademark",fn:function(e){var a=e.item;return[n("ul",t._l(a.connections,(function(e,a){return n("li",{key:a},[t._v(t._s(e.trademark))])})),0)]}},{key:"item.debt",fn:function(e){var a=e.item;return[n("ul",t._l(a.connections,(function(e,a){return n("li",{key:a},[t._v(t._s(e.debt))])})),0)]}},{key:"item._personalAccounts",fn:function(e){var a=e.item;return t._l(a.connections,(function(e,a){return n("p",{key:a},[t._v("\n                            "+t._s(e.personal_account)+"\n                        ")])}))}},{key:"footer.page-text",fn:function(e){var n=e.pageStart,a=e.pageStop,r=e.itemsLength;return[t._v("\n                        "+t._s(n)+"-"+t._s(a)+" из "+t._s(r)+"\n                    ")]}}],null,!1,3801155092)})],1):t._e()])],1),t._v(" "),n("ExportDebtsModal",{attrs:{state:t.exportModal},on:{cancel:function(e){t.exportModal=!1},submit:t.exportData}})],1)}),[],!1,null,"a206699c",null).exports}},m=Object(v.a)(p,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("ReceivableTable")],1)}),[],!1,null,"25c23218",null);e.default=m.exports}}]);