(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{23:function(e,t,n){var a=n(59);"string"==typeof a&&(a=[[e.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(11)(a,s);a.locals&&(e.exports=a.locals)},58:function(e,t,n){"use strict";var a=n(23);n.n(a).a},59:function(e,t,n){(e.exports=n(10)(!1)).push([e.i,"\n.modal-text[data-v-2adaa561] {\n    margin-top: 15px!important;;\n    font-size: 16px;\n}\n",""])},9:function(e,t,n){"use strict";var a={props:{state:{type:Boolean,default:!1},title:{type:String,default:"Подтвердите действие"},message:{type:String,required:!0},okMessage:{type:String,default:"ОК"},cancelMessage:{type:String,default:"Отмена"}},methods:{onConfirm:function(){this.$emit("confirm")},onCancel:function(){this.$emit("cancel")}}},s=(n(58),n(2)),i=Object(s.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{attrs:{persistent:"",width:"500"},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"headline blue darken-1 justify-content-between"},[n("span",{staticClass:"white--text"},[e._v(e._s(e.title))]),e._v(" "),n("v-btn",{staticClass:"float-right",attrs:{icon:"",text:""}},[n("v-icon",{attrs:{color:"white"},on:{click:e.onCancel}},[e._v("\n                        mdi-close\n                    ")])],1)],1),e._v(" "),n("v-card-text",{staticClass:"modal-text"},[e._v("\n                "+e._s(e.message)+"\n            ")]),e._v(" "),n("v-divider"),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:""},on:{click:e.onCancel}},[e._v("\n                    "+e._s(e.cancelMessage)+"\n                ")]),e._v(" "),n("v-btn",{attrs:{color:"success",text:""},on:{click:e.onConfirm}},[e._v("\n                    "+e._s(e.okMessage)+"\n                    "),n("v-icon",[e._v("mdi-check")])],1)],1)],1)],1)],1)}),[],!1,null,"2adaa561",null);t.a=i.exports},91:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(4);String.prototype.replaceAll=function(e,t){return this.split(e).join(t)};var r={props:{state:{type:Boolean,default:!1},id:{type:Number,default:null}},computed:{message:function(){var e=this.body;return this.variables.forEach((function(t){e=e.replaceAll(t.key,t.example)})),e}},watch:{state:function(){if(this.name="",this.title="",this.body="",null!==this.id){var e=this.$store.getters.mailing_template(this.id);this.name=e.name,this.title=e.title,this.body=e.body}}},data:function(){return{loading:!1,name:"",title:"",body:"",variables:[{key:"%ИМЯ%",name:"Имя клиента",example:"Александр Андреевич"}]}},methods:{onSubmit:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,null!==this.id){e.next=6;break}return e.next=4,s.a.awrap(this.createTemplate());case 4:e.next=8;break;case 6:return e.next=8,s.a.awrap(this.editTemplate());case 8:this.$emit("onClose"),this.loading=!1;case 11:case"end":return e.stop()}}),null,this)},createTemplate:function(){var e;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e={title:this.title,body:this.body,name:this.name},t.next=3,s.a.awrap(this.$store.dispatch("createMailingTemplates",e));case 3:Object(i.a)("Шаблон успешно создан!");case 4:case"end":return t.stop()}}),null,this)},editTemplate:function(){var e;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e={id:this.id,title:this.title,body:this.body,name:this.name},t.next=3,s.a.awrap(this.$store.dispatch("editMailingTemplates",e));case 3:Object(i.a)("Шаблон успешно отредактирован!");case 4:case"end":return t.stop()}}),null,this)},addVariableToTemplate:function(e){this.body+=e.key}}},l=n(2),o=Object(l.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{"max-width":"800",persistent:""},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}},[n("v-card",[n("v-card-title",{staticClass:"blue darken-1 d-flex justify-content-between"},[n("span",{staticClass:"white--text"},[e._v(e._s(null===e.id?"Добавление":"Редактирование")+" шаблона")]),e._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$emit("onClose")}}},[n("v-icon",{attrs:{color:"white"}},[e._v("mdi-close")])],1)],1),e._v(" "),n("v-card-text",[e.loading?e._e():n("v-form",{staticClass:"p-3"},[n("v-text-field",{attrs:{label:"Наименование шаблона"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),n("v-text-field",{attrs:{label:"Заголовок"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),n("v-textarea",{attrs:{"auto-grow":"",rows:"5",counter:"",label:"Текст"},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}}),e._v(" "),n("v-flex",{staticClass:"mb-2"},[n("h4",{staticClass:"ml-1"},[e._v("Переменные:")]),e._v(" "),e._l(e.variables,(function(t,a){return n("v-btn",{key:a,staticClass:"m-1",attrs:{small:"",color:"primary"},on:{click:function(n){return e.addVariableToTemplate(t)}}},[e._v("\n                        "+e._s(t.name)+"\n                    ")])}))],2),e._v(" "),n("v-divider"),e._v(" "),n("v-flex",{staticClass:"mt-2"},[n("h3",[e._v("Предпросмотр шаблона:")]),e._v(" "),n("h4",[e._v(e._s(this.title))]),e._v(" "),n("p",[e._v(e._s(this.message))])])],1)],1),e._v(" "),n("v-divider"),e._v(" "),e.loading?e._e():n("v-card-actions",[n("v-btn",{attrs:{text:""},on:{click:function(t){return e.$emit("onClose")}}},[e._v("Отмена")]),e._v(" "),n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:"",color:"success"},on:{click:e.onSubmit}},[e._v("\n                Сохранить\n                "),n("v-icon",[e._v("mdi-check")])],1)],1),e._v(" "),n("v-progress-linear",{attrs:{indeterminate:"",active:e.loading,color:"green",absolute:"",bottom:""}})],1)],1)}),[],!1,null,"7d46370f",null).exports,c=n(9),u={components:{ConfirmationModal:c.a,AddMailingTemplateModal:o},methods:{onEdit:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:this.showEditModal=!1,Object(i.a)("","Шаблон успешно изменен!");case 2:case"end":return e.stop()}}),null,this)},onSave:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:this.showAddModal=!1,Object(i.a)("","Шаблон успешно добавлен!");case 2:case"end":return e.stop()}}),null,this)}},computed:{templates:function(){return this.$store.getters.mailing_templates}},data:function(){return{id:null,showEditModal:!1,showAddModal:!1,showDeleteModal:!1,headers:[{text:"Наименование шаблона",value:"title",sortable:!1},{text:"Текст шаблона",value:"body",sortable:!1},{text:"Действие",value:"action",sortable:!1}],search:""}}},d=Object(l.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-3"},[n("div",{staticClass:"d-flex justify-content-end"},[n("v-btn",{staticClass:"mb-2",attrs:{color:"primary"},on:{click:function(t){e.showAddModal=!0}}},[e._v("Добавить шаблон")])],1),e._v(" "),n("v-data-table",{attrs:{"no-results-text":"Нет результатов","no-data-text":"Нет данных","footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:e.headers,items:e.templates,search:e.search},scopedSlots:e._u([{key:"item.action",fn:function(t){var a=t.item;return[n("v-btn",{attrs:{icon:""},on:{click:function(t){e.id=a.id,e.showAddModal=!0}}},[n("v-icon",[e._v("mdi-pencil")])],1),e._v(" "),n("v-btn",{attrs:{icon:""}},[n("v-icon",[e._v("mdi-delete")])],1)]}},{key:"footer.page-text",fn:function(t){var n=t.pageStart,a=t.pageStop,s=t.itemsLength;return[e._v("\n            "+e._s(n)+"-"+e._s(a)+" из "+e._s(s)+"\n        ")]}}])}),e._v(" "),n("AddMailingTemplateModal",{attrs:{state:e.showAddModal,id:e.id},on:{onClose:function(t){e.id=null,e.showAddModal=!1}}}),e._v(" "),n("ConfirmationModal",{attrs:{state:e.showDeleteModal,message:"Вы действительно хотите удалить выбранный шаблон?"},on:{confirm:function(t){e.showDeleteModal=!1},cancel:function(t){e.showDeleteModal=!1}}})],1)}),[],!1,null,"17d90edc",null).exports,v=n(15);function m(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}String.prototype.replaceAll=function(e,t){return this.split(e).join(t)};var p={components:{ConfirmationModal:c.a},methods:{addVariableToTemplate:function(e){this.body+=e.key},sendMailing:function(){var e;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e={title:this.title,body:this.body,clients:this.selected.map((function(e){return e.id})),sendType:this.sendType},this.showModal=!1,t.next=4,s.a.awrap(Object(v.g)(e));case 4:Object(i.a)("Рассылка была отправлена");case 5:case"end":return t.stop()}}),null,this)}},data:function(){return{showModal:!1,sendingTypes:[{id:0,name:"Все"},{id:1,name:"SMS"},{id:"2",name:"Пуш-уведомления"}],sendType:2,variables:[{key:"%ИМЯ%",name:"Имя клиента",example:"Александр Андреевич"}],methods:{addVariableToTemplate:function(e){this.body+=e.key}},search:"",selected:[],currentTemplate:null,headers:[{text:"Контрагент",align:"left",sortable:!1,value:"name"},{text:"Лицевой счет",value:"personal_accounts",sortable:!1},{text:"Адрес",value:"addresses",sortable:!1},{text:"Торговое наименование",value:"trademarks",sortable:!1}],isFreeTemplate:!1,clientGroup:null,clientGroups:["Все","Должники"],title:"",body:""}},watch:{currentTemplate:function(){var e=this.$store.getters.mailing_template(this.currentTemplate);return this.body=e.body,this.title=e.title,e}},computed:{clients:function(){var e=[];return e="Все"===this.clientGroup?this.$store.getters.allClients:this.$store.getters.debts,this.selected=m(e),e},message:function(){var e=this.body;return this.variables.forEach((function(t){e=e.replaceAll(t.key,t.example)})),e},templates:function(){return this.$store.getters.mailing_templates}}},f=Object(l.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[0===e.$store.getters.debts.length?n("div",{staticClass:"text-center d-flex align-items-center justify-content-center",staticStyle:{"min-height":"651px"}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"65",color:"primary"}})],1):n("v-form",{staticClass:"p-3"},[n("v-select",{attrs:{"item-value":"id","item-text":"name",label:"Тип отправки",items:e.sendingTypes},model:{value:e.sendType,callback:function(t){e.sendType=t},expression:"sendType"}}),e._v(" "),n("v-flex",[e.isFreeTemplate?e._e():n("v-select",{attrs:{label:"Шаблон",items:e.templates,"item-text":"name","item-value":"id"},model:{value:e.currentTemplate,callback:function(t){e.currentTemplate=t},expression:"currentTemplate"}}),e._v(" "),n("v-checkbox",{attrs:{label:"Произвольный шаблон"},model:{value:e.isFreeTemplate,callback:function(t){e.isFreeTemplate=t},expression:"isFreeTemplate"}})],1),e._v(" "),n("v-text-field",{attrs:{label:"Заголовок"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),e._v(" "),n("v-textarea",{attrs:{label:"Текст","auto-grow":"",rows:"5",counter:""},model:{value:e.body,callback:function(t){e.body=t},expression:"body"}}),e._v(" "),n("v-flex",{staticClass:"mb-2"},[n("h4",{staticClass:"ml-1"},[e._v("Переменные:")]),e._v(" "),e._l(e.variables,(function(t,a){return n("v-btn",{key:a,staticClass:"m-1",attrs:{small:"",color:"primary"},on:{click:function(n){return e.addVariableToTemplate(t)}}},[e._v("\n                "+e._s(t.name)+"\n            ")])}))],2),e._v(" "),n("v-select",{attrs:{label:"Группа клиентов",items:e.clientGroups},model:{value:e.clientGroup,callback:function(t){e.clientGroup=t},expression:"clientGroup"}}),e._v(" "),e.clientGroup?n("v-data-table",{attrs:{"item-key":"id","show-select":"","no-results-text":"Нет результатов","no-data-text":"Нет данных","footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:e.headers,items:e.clients,search:e.search},scopedSlots:e._u([{key:"item.personal_accounts",fn:function(t){var a=t.item;return[n("ul",e._l(a.personal_accounts,(function(t,a){return n("li",{key:a},[e._v(e._s(t))])})),0)]}},{key:"item.addresses",fn:function(t){var a=t.item;return[n("ul",e._l(a.addresses,(function(t,a){return n("li",{key:a},[e._v(e._s(t))])})),0)]}},{key:"item.trademarks",fn:function(t){var a=t.item;return[n("ul",e._l(a.trademarks,(function(t,a){return n("li",{key:a},[e._v(e._s(t))])})),0)]}},{key:"footer.page-text",fn:function(t){var n=t.pageStart,a=t.pageStop,s=t.itemsLength;return[e._v("\n                "+e._s(n)+"-"+e._s(a)+" из "+e._s(s)+"\n            ")]}}],null,!1,2844864363),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e(),e._v(" "),e.clientGroup?n("div",{staticClass:"d-flex"},[n("h4",[e._v("Количество получателей: "+e._s(e.selected.length))])]):e._e(),e._v(" "),n("v-divider"),e._v(" "),n("v-flex",{staticClass:"mt-2"},[n("h3",[e._v("Предпросмотр шаблона:")]),e._v(" "),n("h4",[e._v(e._s(this.title))]),e._v(" "),n("p",[e._v(e._s(this.message))])]),e._v(" "),e.selected.length?n("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.showModal=!0}}},[e._v("Отправить рассылку")]):e._e()],1),e._v(" "),n("ConfirmationModal",{attrs:{state:e.showModal,message:"Вы действительно хотите отправить эту рассылку?"},on:{cancel:function(t){e.showModal=!1},confirm:e.sendMailing}})],1)}),[],!1,null,"77854d99",null).exports;var h={components:{ConfirmationModal:c.a},mounted:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(Object(v.e)());case 2:this.items=e.sent;case 3:case"end":return e.stop()}}),null,this)},data:function(){return{showDeleteModal:!1,search:"",items:[],id:null,headers:[{text:"Заголовок",value:"title",sortable:!1},{text:"Текст",value:"body",sortable:!1},{text:"Дата рассылки",value:"date"},{text:"Количество получателей",value:"recipient_count"},{text:"Автор",value:"user",sortable:!1},{text:"Действие",value:"action",sortable:!1}]}},computed:{},methods:{deleteHistory:function(){var e=this;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.a.awrap(Object(v.b)(this.id));case 2:this.items=this.items.filter((function(t){return t.id!==e.id})),this.id=null,this.showDeleteModal=!1,Object(i.a)("Рассылка успешно удалена!");case 6:case"end":return t.stop()}}),null,this)}}},_={components:{MailingHistorySegment:Object(l.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-2"},[n("v-text-field",{attrs:{label:"Поиск",clearable:"","single-line":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),n("v-data-table",{attrs:{"no-data-text":"Нет данных","no-results-text":"Нет результатов",items:e.items,"footer-props":{"items-per-page-options":[10,15,{text:"Все",value:-1}],"items-per-page-text":"Записей на странице"},headers:e.headers,search:e.search},scopedSlots:e._u([{key:"item.body",fn:function(t){var a=t.item;return[n("i",[e._v(e._s(a.body))])]}},{key:"item.action",fn:function(t){var a=t.item;return[n("v-btn",{attrs:{icon:""},on:{click:function(t){e.id=a.id,e.showDeleteModal=!0}}},[n("v-icon",[e._v("mdi-delete")])],1)]}},{key:"footer.page-text",fn:function(t){var n=t.pageStart,a=t.pageStop,s=t.itemsLength;return[e._v("\n            "+e._s(n)+"-"+e._s(a)+" из "+e._s(s)+"\n        ")]}}])}),e._v(" "),n("ConfirmationModal",{attrs:{state:e.showDeleteModal,message:"'Вы действительно хотите удалить данную рассылку из истории?"},on:{cancel:function(t){e.id=null,e.showDeleteModal=!1},confirm:e.deleteHistory}})],1)}),[],!1,null,"04279ec4",null).exports,MailingSegment:f,MailingTemplateSegment:d},data:function(){return{currentSegment:"mailing"}},mounted:function(){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.awrap(this.$store.dispatch("getDebts"));case 2:return e.next=4,s.a.awrap(this.$store.dispatch("getMailingTemplates"));case 4:case"end":return e.stop()}}),null,this)}},b=Object(l.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",[n("v-card-title",[e._v("\n            Рассылка\n        ")]),e._v(" "),n("v-card-text",[n("div",{staticClass:"p-3"},[n("v-btn",{attrs:{depressed:"",color:"mailing"===e.currentSegment?"primary":""},on:{click:function(t){e.currentSegment="mailing"}}},[e._v("\n                    Рассылка\n                ")]),e._v(" "),n("v-btn",{attrs:{depressed:"",color:"mailing_history"===e.currentSegment?"primary":""},on:{click:function(t){e.currentSegment="mailing_history"}}},[e._v("\n                    История рассылок\n                ")]),e._v(" "),n("v-btn",{attrs:{depressed:"",color:"mailing_template"===e.currentSegment?"primary":""},on:{click:function(t){e.currentSegment="mailing_template"}}},[e._v("\n                    Шаблоны\n                ")]),e._v(" "),"mailing"===e.currentSegment?n("MailingSegment"):e._e(),e._v(" "),"mailing_history"===e.currentSegment?n("MailingHistorySegment"):e._e(),e._v(" "),"mailing_template"===e.currentSegment?n("MailingTemplateSegment"):e._e()],1)])],1)],1)}),[],!1,null,"dfd16ab8",null);t.default=b.exports}}]);